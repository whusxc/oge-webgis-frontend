# OGE WebGIS å‰ç«¯å¹³å°

åŸºäºOGEå’ŒMCPçš„æ™ºèƒ½åœ°ç†åˆ†æå¹³å°å‰ç«¯ã€‚

## ğŸŒŸ é¡¹ç›®ç‰¹æ€§

- **ğŸ—ºï¸ åœ°å›¾å¯è§†åŒ–**: åŸºäºMapbox GL JSçš„é«˜æ€§èƒ½åœ°å›¾æ¸²æŸ“
- **ğŸ”§ MCPå·¥å…·é›†æˆ**: å®Œæ•´çš„åœ°ç†åˆ†æå·¥å…·ï¼ˆå¡åº¦åˆ†æã€ç¼“å†²åŒºåˆ†æã€è€•åœ°æµå‡ºåˆ†æç­‰ï¼‰
- **ğŸ¤– AIæ™ºèƒ½åŠ©æ‰‹**: é›†æˆGPT/ChatGLMçš„æ™ºèƒ½å¯¹è¯å’Œåˆ†æå»ºè®®
- **ğŸ“Š æ•°æ®ç®¡ç†**: å›¾å±‚ç®¡ç†ã€æ•°æ®å¯¼å…¥å¯¼å‡ºã€ç»“æœå¯è§†åŒ–
- **âš¡ ç°ä»£æŠ€æœ¯æ ˆ**: Vue 3 + Vite + Element Plus + TypeScript
- **ğŸ“± å“åº”å¼è®¾è®¡**: æ”¯æŒæ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡
- **ğŸ³ å®¹å™¨åŒ–éƒ¨ç½²**: æ”¯æŒDockerå’Œä¼ ç»Ÿéƒ¨ç½²æ–¹å¼

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯å±•ç¤ºå±‚     â”‚    ä¸šåŠ¡é€»è¾‘å±‚     â”‚     æ•°æ®æœåŠ¡å±‚    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Vue 3           â”‚ MCP API         â”‚ MCPæœåŠ¡å™¨        â”‚
â”‚ Mapbox GL JS    â”‚ AI Chat API     â”‚ é¥æ„Ÿå¤§æ¥¼ç¯å¢ƒ      â”‚
â”‚ Element Plus    â”‚ çŠ¶æ€ç®¡ç†         â”‚ MinIOå­˜å‚¨        â”‚
â”‚ TypeScript      â”‚ è·¯ç”±ç®¡ç†         â”‚ PostgreSQL      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js 16+ 
- npm æˆ– pnpm
- ç°ä»£æµè§ˆå™¨(æ”¯æŒES6+)

### å®‰è£…å’Œè¿è¡Œ

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd oge-webgis

# 2. å®‰è£…ä¾èµ–
npm install
# æˆ–ä½¿ç”¨ pnpm
pnpm install

# 3. å¼€å‘æ¨¡å¼
npm run dev

# 4. æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# 5. æœ¬åœ°é¢„è§ˆæ„å»ºç»“æœ
npm run preview
```

### ä½¿ç”¨éƒ¨ç½²è„šæœ¬

é¡¹ç›®æä¾›äº†ä¾¿æ·çš„éƒ¨ç½²è„šæœ¬ï¼š

```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x deploy.sh

# å¼€å‘æ¨¡å¼
./deploy.sh dev

# å®Œæ•´éƒ¨ç½²ï¼ˆå®‰è£…+æ„å»º+éƒ¨ç½²ï¼‰
./deploy.sh full

# éƒ¨ç½²åˆ°æŒ‡å®šè·¯å¾„
./deploy.sh deploy /var/www/html/oge

# åˆ›å»ºDockeré…ç½®
./deploy.sh docker

# æŸ¥çœ‹å¸®åŠ©
./deploy.sh help
```

## ğŸ¯ åŠŸèƒ½æ¨¡å—

### 1. åœ°å›¾è§†å›¾ (`MapView`)
- å¤šç§åº•å›¾æ ·å¼é€‰æ‹©
- å›¾å±‚ç®¡ç†å’Œæ§åˆ¶
- åœ°å›¾äº¤äº’æ“ä½œ
- ç©ºé—´æ•°æ®å¯è§†åŒ–

### 2. MCPå·¥å…·ç®± (`McpToolBar`)
- **åœ°å½¢åˆ†æ**: å¡åº¦åˆ†æã€é«˜ç¨‹åˆ†æ
- **ç©ºé—´åˆ†æ**: ç¼“å†²åŒºåˆ†æã€å åŠ åˆ†æ
- **å†œä¸šåˆ†æ**: è€•åœ°æµå‡ºã€ä½œç‰©åˆ†ç±»
- **ç‰¹å¾æå–**: é“è·¯æå–ã€æ°´ä½“æå–
- **å½±åƒåˆ†ç±»**: é¥æ„Ÿå½±åƒæ™ºèƒ½åˆ†ç±»

### 3. æ™ºèƒ½åŠ©æ‰‹ (`ChatBox`)
- è‡ªç„¶è¯­è¨€äº¤äº’
- æ™ºèƒ½å·¥å…·æ¨è
- åˆ†æç»“æœè§£é‡Š
- æ“ä½œæŒ‡å¯¼

### 4. å›¾å±‚ç®¡ç† (`LayerPanel`)
- å›¾å±‚å¢åˆ æ”¹æŸ¥
- æ ·å¼å’Œé€æ˜åº¦è°ƒæ•´
- å›¾å±‚ä¿¡æ¯æŸ¥çœ‹
- ç»“æœå›¾å±‚ç®¡ç†

### 5. ä»»åŠ¡ä¸­å¿ƒ (`TaskProgress`)
- ä»»åŠ¡çŠ¶æ€ç›‘æ§
- è¿›åº¦å®æ—¶æ›´æ–°
- ç»“æœé¢„è§ˆå’Œä¸‹è½½
- é”™è¯¯å¤„ç†å’Œé‡è¯•

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒé…ç½®

é¡¹ç›®æ”¯æŒå¤šç¯å¢ƒé…ç½®ï¼Œä¸»è¦é…ç½®é¡¹ä½äº `src/stores/app.js`:

```javascript
// MCPæœåŠ¡é…ç½®
mcp: {
  baseUrl: 'http://localhost:8000',  // MCPæœåŠ¡å™¨åœ°å€
  timeout: 30000
},

// OGEæœåŠ¡é…ç½®  
oge: {
  baseUrl: 'http://10.101.240.20',  // é¥æ„Ÿå¤§æ¥¼OGEæœåŠ¡
  port: 16555
},

// Mapboxé…ç½®
mapbox: {
  accessToken: 'your-mapbox-token',  // éœ€è¦æ›¿æ¢ä¸ºæ‚¨çš„token
  style: 'mapbox://styles/mapbox/streets-v11',
  center: [116.3974, 39.9093],  // åŒ—äº¬åæ ‡
  zoom: 10
}
```

### APIä»£ç†é…ç½®

å¼€å‘ç¯å¢ƒä¸‹ï¼ŒAPIè¯·æ±‚é€šè¿‡Viteä»£ç†è½¬å‘ï¼š

```javascript
// vite.config.js
proxy: {
  '/api/mcp': {
    target: 'http://localhost:8000',
    changeOrigin: true,
    rewrite: (path) => path.replace(/^\/api\/mcp/, '')
  },
  '/api/oge': {
    target: 'http://10.101.240.20:16555',
    changeOrigin: true,
    rewrite: (path) => path.replace(/^\/api\/oge/, '')
  }
}
```

## ğŸš€ éƒ¨ç½²æ–¹æ¡ˆ

### 1. Nginxéƒ¨ç½²

```bash
# æ„å»ºé¡¹ç›®
npm run build

# å¤åˆ¶åˆ°Nginxç›®å½•
sudo cp -r dist/* /usr/share/nginx/html/oge/

# é…ç½®Nginx
sudo cp nginx.conf /etc/nginx/sites-available/oge
sudo ln -s /etc/nginx/sites-available/oge /etc/nginx/sites-enabled/
sudo nginx -t && sudo systemctl reload nginx
```

### 2. Dockeréƒ¨ç½²

```bash
# ä½¿ç”¨éƒ¨ç½²è„šæœ¬
./deploy.sh docker

# æˆ–æ‰‹åŠ¨æ„å»º
docker build -t oge-frontend .
docker run -d -p 3000:80 --name oge oge-frontend
```

### 3. Docker Composeéƒ¨ç½²

```bash
# å¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

## ğŸ”Œ MCPæœåŠ¡é›†æˆ

### æœåŠ¡åœ°å€é…ç½®

ç¡®ä¿MCPæœåŠ¡å™¨æ­£å¸¸è¿è¡Œåœ¨é¥æ„Ÿå¤§æ¥¼ç¯å¢ƒï¼š

```bash
# æ£€æŸ¥MCPæœåŠ¡çŠ¶æ€
curl http://localhost:8000/health

# æ£€æŸ¥å·¥å…·åˆ—è¡¨
curl http://localhost:8000/tools

# æµ‹è¯•å¡åº¦åˆ†æ
curl -X POST http://localhost:8000/slope_analysis \
  -H "Content-Type: application/json" \
  -d '{"area": "beijing"}'
```

### APIæ¥å£è¯´æ˜

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|-----|-----|-----|
| `/health` | GET | å¥åº·æ£€æŸ¥ |
| `/tools` | GET | è·å–å¯ç”¨å·¥å…·åˆ—è¡¨ |
| `/slope_analysis` | POST | å¡åº¦åˆ†æ |
| `/buffer_analysis` | POST | ç¼“å†²åŒºåˆ†æ |
| `/farmland_outflow` | POST | è€•åœ°æµå‡ºåˆ†æ |
| `/road_extraction` | POST | é“è·¯æå– |
| `/water_extraction` | POST | æ°´ä½“æå– |

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### åº”ç”¨ç›‘æ§

- å‰ç«¯é”™è¯¯ç›‘æ§
- APIè¯·æ±‚ç›‘æ§  
- ç”¨æˆ·è¡Œä¸ºåˆ†æ
- æ€§èƒ½æŒ‡æ ‡ç›‘æ§

### æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker logs oge-gaplus-frontend

# æŸ¥çœ‹Nginxè®¿é—®æ—¥å¿—
tail -f /var/log/nginx/access.log

# æŸ¥çœ‹Nginxé”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/error.log
```

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ components/          # å¯å¤ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ LayerPanel.vue   # å›¾å±‚æ§åˆ¶é¢æ¿
â”‚   â”œâ”€â”€ McpToolBar.vue   # MCPå·¥å…·æ 
â”‚   â”œâ”€â”€ ChatBox.vue      # æ™ºèƒ½åŠ©æ‰‹
â”‚   â””â”€â”€ TaskProgress.vue # ä»»åŠ¡è¿›åº¦
â”œâ”€â”€ views/               # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ MapView.vue      # åœ°å›¾ä¸»è§†å›¾
â”‚   â”œâ”€â”€ Login.vue        # ç™»å½•é¡µé¢
â”‚   â””â”€â”€ Dashboard.vue    # æ§åˆ¶å°
â”œâ”€â”€ stores/              # çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ app.js           # åº”ç”¨çŠ¶æ€
â”œâ”€â”€ services/            # APIæœåŠ¡
â”‚   â””â”€â”€ api.js           # APIå°è£…
â”œâ”€â”€ router/              # è·¯ç”±é…ç½®
â”‚   â””â”€â”€ index.js         # è·¯ç”±å®šä¹‰
â””â”€â”€ assets/              # é™æ€èµ„æº
    â””â”€â”€ styles/          # æ ·å¼æ–‡ä»¶
```

### æ·»åŠ æ–°å·¥å…·

1. åœ¨ `McpToolBar.vue` ä¸­æ·»åŠ å·¥å…·å®šä¹‰
2. å®ç°å·¥å…·å‚æ•°è¡¨å•
3. è°ƒç”¨MCP API
4. å¤„ç†è¿”å›ç»“æœå¹¶æ˜¾ç¤ºåœ¨åœ°å›¾ä¸Š

### æ ·å¼å¼€å‘

é¡¹ç›®ä½¿ç”¨SCSSï¼Œæ”¯æŒå˜é‡å’Œæ··å…¥ï¼š

```scss
// ä½¿ç”¨CSSå˜é‡
.my-component {
  color: var(--primary-color);
  background: var(--background-color-base);
}

// ä½¿ç”¨å·¥å…·ç±»
.my-layout {
  @extend .flex-between;
  @extend .p-20;
}
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯: `git checkout -b feature/new-feature`
3. æäº¤å˜æ›´: `git commit -am 'Add new feature'`
4. æ¨é€åˆ†æ”¯: `git push origin feature/new-feature`
5. æäº¤Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ†˜ æ”¯æŒ

å¦‚æœæ‚¨é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œè¯·ï¼š

1. æŸ¥çœ‹[å¸¸è§é—®é¢˜](docs/FAQ.md)
2. æœç´¢ç°æœ‰[Issues](issues)
3. åˆ›å»ºæ–°çš„Issue
4. è”ç³»å¼€å‘å›¢é˜Ÿ

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-12-XX)
- âœ¨ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- ğŸ—ºï¸ åœ°å›¾åŸºç¡€åŠŸèƒ½
- ğŸ”§ MCPå·¥å…·é›†æˆ
- ğŸ¤– AIåŠ©æ‰‹åŠŸèƒ½
- ğŸ“Š å›¾å±‚ç®¡ç†
- ğŸš€ éƒ¨ç½²è„šæœ¬ 